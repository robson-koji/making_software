function define(a,b,c){typeof a!="string"?(console.error(this.depth+" Error: Module name is not a string."),console.trace()):(arguments.length==2&&(c=b),define.debugDependencies&&console.log("define: "+a+" -> "+c.toString().slice(0,40).replace(/\n/,"\\n").replace(/\r/,"\\r")+"..."),a in define.modules&&console.error(this.depth+" Error: Redefining module: "+a),define.modules[a]=c)}define.modules={},define.debugDependencies=!1,function(){function a(){this.modules={},define.debugDependencies&&(this.depth="")}a.prototype.require=function(a,b){if(Array.isArray(a)){var c=a.map(function(a){return this.lookup(a)},this);b&&b.apply(null,c);return undefined}return this.lookup(a)},a.prototype.lookup=function(a){if(a in this.modules){var b=this.modules[a];define.debugDependencies&&console.log(this.depth+" Using module: "+a);return b}if(a in define.modules){var b=define.modules[a];define.debugDependencies&&console.log(this.depth+" Compiling module: "+a);if(typeof b=="function"){define.debugDependencies&&(this.depth+=".");var c={};try{b(this.require.bind(this),c,{id:a,uri:""})}catch(d){console.error("Error using module: "+a,d);throw d}b=c,define.debugDependencies&&(this.depth=this.depth.slice(0,-1))}this.modules[a]=b;return b}console.error(this.depth+" Missing module: "+a);return null},define.Domain=a,define.globalDomain=new a}();var require=define.globalDomain.require.bind(define.globalDomain);define("dwf",["require","exports","module","dwf/widgets","dwf/util","dwf/transactions","dwf/views/control-panel","dwf/views/form-preview","dwf/views/messages","dwf/models/form"],function(a,b,c){var d=a("dwf/widgets"),e=a("dwf/util"),f=a("dwf/transactions"),g=a("dwf/views/control-panel").ControlPanel,h=a("dwf/views/form-preview").FormPreview,i=a("dwf/views/messages").Messages,j=a("dwf/models/form").Form,k=new j(JSON.parse($("#initial-form")[0].textContent)),l=new g,m=new h,n=new i,o=document.getElementById("DWF-base");l.activate(o,{addField:function(a,b){e.prompt("Field Label:",function(c){if(c)if(k.getFieldByLabel(c))e.prompt("A field with that label already exists. Enter a new one:",arguments.callee);else{var d=k.addField(c,a,b);m.addField(d)}})},activeFieldExists:function(){return k.activeField},noFieldsExist:function(){return!k.hasFields()},getActiveFieldLabel:function(){return k.activeField.label()},getActiveFieldHelpText:function(){return k.activeField.helpText()},getActiveFieldRequired:function(){return k.activeField.required()},getActiveFieldType:function(){return k.activeField.type()},getActiveFieldWidget:function(){return k.activeField.widget()},getActiveFieldChoices:function(a,b){return k.activeField.choices()},addChoice:function(a,b){e.prompt("Choice Label:",function(c){c&&(k.activeField.getChoiceByLabel(c)?e.prompt("A choice with that label already exists. Enter a new label:",arguments.callee):(k.activeField.addChoice(c),m.displayActiveFieldWidget(k.activeField.widget(),k.activeField.choices()),a.call(b,c)))})},deleteChoice:function(a){k.activeField.deleteChoice(a),m.displayActiveFieldWidget(k.activeField.widget(),k.activeField.choices())},updateActiveFieldLabel:function(a){k.activeField.label(a),m.displayActiveFieldLabel(a)},updateActiveFieldHelpText:function(a){k.activeField.helpText(a),m.displayActiveFieldHelpText(a)},updateActiveFieldRequired:function(a){k.activeField.required(a),m.displayActiveFieldRequired(a)},updateActiveFieldType:function(a){k.activeField.type(a)},updateActiveFieldWidget:function(a){k.activeField.widget(a),m.displayActiveFieldWidget(a,k.activeField.choices())},updateActiveFieldChoices:function(a){k.activeField.eachChoice(function(b,c){b.label(a.shift()),b.position(c)}),m.displayActiveFieldWidget(k.activeField.widget(),k.activeField.choices())},getFormName:function(){return k.name()},getFormDescription:function(){return k.description()},updateFormName:function(a){k.name(a),m.displayFormName(a)},updateFormDescription:function(a){k.description(a),m.displayFormDescription(a)},saveNow:e.bind(f.saveNow,f)}),m.activate(o,{activateField:function(a){k.activeField=k.getFieldByLabel(a),l.openFieldSettingsTab()},deleteField:function(a){k.deleteField(a)},deleteActiveField:function(a){l.openFormSettingsTab(),k.deleteField(a)},updateFieldPosition:function(a,b){k.getFieldByLabel(a).position(b)}}),m.displayFormName(k.name()),m.displayFormDescription(k.description()),k.eachField(function(a,b){m.addField(a)}),n.activate(document.body),f.startAutoSaveLoop(function(){var a;return{target:document.getElementById("save-target").textContent,formId:k.id(),preSave:function(){l.disableSave(),a=n.info("Saving...")},postSave:function(){l.enableSave(),n.removeMessage(a);var b=new Date;n.success("Successfully saved at "+(b.getHours()%12||12)+":"+(b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes()))},error:function(b){l.enableSave(),n.removeMessage(a),n.warn("There was an error saving."),b&&console.error("Server error: "+b)}}}())}),define("dwf/widgets",["require","exports","module"],function(a,b,c){var d=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push([c,'="',a[c],'"'].join(""));return b.join(" ")},e=function(a){return a[0]},f=function(a){return a[1]},g=function(){};g.prototype.inputType=null,g.prototype.render=function(a,b){a&&(b.name=a);return["<input",d(b),'type="'+this.inputType+'" />'].join(" ")};var h=function(){};h.prototype=new g,h.prototype.inputType="radio",b.TextInput=function(){},b.TextInput.prototype=new g,b.TextInput.prototype.inputType="text",b.PasswordInput=function(){},b.PasswordInput.prototype=new g,b.PasswordInput.prototype.inputType="password",b.FileInput=function(){},b.FileInput.prototype=new g,b.FileInput.prototype.inputType="file",b.DateInput=function(){},b.DateInput.prototype=new b.TextInput,b.DateTimeInput=function(){},b.DateTimeInput.prototype=new b.TextInput,b.TimeInput=function(){},b.TimeInput.prototype=new b.TextInput,b.CheckboxInput=function(){},b.CheckboxInput.prototype=new g,b.CheckboxInput.prototype.inputType="checkbox",b.Textarea=function(){},b.Textarea.prototype.render=function(a,b){a&&(b.name=a);return["<textarea",d(b),"></textarea>"].join(" ")},b.Select=function(){},b.Select.prototype.render=function(a,b,c){a&&(b.name=a);var g,h=[["<select ",d(b),">"].join("")];for(g=0;g<c.length;g++)h.push(['<option value="',e(c[g]),'">',f(c[g]),"</option>"].join(""));h.push("</select>");return h.join("\n")},b.SelectMultiple=function(){},b.SelectMultiple.prototype=new b.Select,b.SelectMultiple.prototype.render=function(a,c,d){a&&(c.name=a),c.multiple="multiple";return b.Select.prototype.render(a,c,d)},b.RadioSelect=function(){},b.RadioSelect.prototype.render=function(a,b,c){a&&(b.name=a);var d,e=["<ul>"];for(d=0;d<c.length;d++)e.push("<li>"+(new h).render(a,b)+f(c[d])+"</li>");e.push("</ul>");return e.join("\n")},b.CheckboxSelectMultiple=function(){},b.CheckboxSelectMultiple.prototype.render=function(a,c,d){a&&(c.name=a);var e,g=["<ul>"];for(e=0;e<d.length;e++)g.push("<li>"+(new b.CheckboxInput).render(a,c)+f(d[e])+"</li>");g.push("</ul>");return g.join("\n")}}),define("dwf/util",["require","exports","module"],function(a,b,c){b.prompt=function(a,b){var c=prompt(a);c=c?c:!1,setTimeout(function(){b(c)},20)},b.getSetter=function(a,b){return function(c){switch(arguments.length){case 0:return this[a];case 1:var d=this[a];this[a]=c,b.call(this,c,d);break;default:throw new TypeError("Expected zero or one argument, received more than one.")}}},b.stringToDOM=function(a){var b=document.createElement("div");b.innerHTML=a;return b.firstChild},b.bind=function(a,b){return function(){return a.apply(b,arguments)}}}),define("dwf/transactions",["require","exports","module","jquery.django-csrf"],function(a,b,c){function l(){var a=d;d=[];if(a.length>0){f&&f();var b=$.post(i,{transactions:JSON.stringify(a)});b.success(function(){g&&g(),e=setTimeout(l,k)}),b.error(function(b){try{h&&h(JSON.parse(b.responseText).error)}catch(c){h&&h()}d=a.concat(d),e=setTimeout(l,k)})}else e=setTimeout(l,k)}a("jquery.django-csrf");var d=[],e,f,g,h,i,j,k=3e4;b.addTransaction=function(a){d.push(a)},b.startAutoSaveLoop=function(a){f=a.preSave,g=a.postSave,h=a.error,i=a.target,j=a.formId,e=setTimeout(l,k)},b.saveNow=function(){clearTimeout(e),l()}}),define("jquery.django-csrf",["require","exports","module"],function(a,b,c){$(document).ajaxSend(function(a,b,c){function f(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function e(a){var b=document.location.host,c=document.location.protocol,d="//"+b,e=c+d;return a==e||a.slice(0,e.length+1)==e+"/"||a==d||a.slice(0,d.length+1)==d+"/"||!/^(\/\/|http:|https:).*/.test(a)}function d(a){var b=null;if(document.cookie&&document.cookie!=""){var c=document.cookie.split(";");for(var d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}}return b}!f(c.type)&&e(c.url)&&b.setRequestHeader("X-CSRFToken",d("csrftoken"))})}),define("dwf/views/control-panel",["require","exports","module","dwf/views/add-field-tab","dwf/views/field-settings-tab","dwf/views/form-settings-tab","dwf/views/base-view","dwf/util","text!dwf/views/control-panel.html"],function(a,b,c){var d=a("dwf/views/add-field-tab").AddFieldTab,e=a("dwf/views/field-settings-tab").FieldSettingsTab,f=a("dwf/views/form-settings-tab").FormSettingsTab,g=a("dwf/views/base-view").View,h=a("dwf/util"),i=b.ControlPanel=function(){};i.prototype=new g,i.prototype._template=a("text!dwf/views/control-panel.html"),i.prototype.activate=function(a,b){g.prototype.activate.call(this,a,b),this._addFieldTab=new d,this._fieldSettingsTab=new e,this._formSettingsTab=new f,this._addFieldTab.activate(this.element,b),this._fieldSettingsTab.activate(this.element,$.extend({openAddFieldTab:h.bind(this.openAddFieldTab,this)},b)),this._formSettingsTab.activate(this.element,b),this.openFormSettingsTab()},i.prototype.addListeners=function(a){$(".add-field",this.element).click(h.bind(this.openAddFieldTab,this)),$(".field-settings",this.element).click(h.bind(this.openFieldSettingsTab,this)),$(".form-settings",this.element).click(h.bind(this.openFormSettingsTab,this))},i.prototype._hideTabs=function(){this._addFieldTab.hide(),$(this.element).find(".add-field").removeClass("DWF-active-tab"),this._fieldSettingsTab.hide(),$(this.element).find(".field-settings").removeClass("DWF-active-tab"),this._formSettingsTab.hide(),$(this.element).find(".form-settings").removeClass("DWF-active-tab")},i.prototype.deactivate=function(){this.addFieldTab.deactivate(),this.fieldSettingsTab.deactivate(),this.formSettingsTab.deactivate(),g.prototype.deactivate.call(this)},i.prototype.openFieldSettingsTab=function(){this._hideTabs(),this._fieldSettingsTab.show(),$(this.element).find(".field-settings").addClass("DWF-active-tab")},i.prototype.openFormSettingsTab=function(){this._hideTabs(),this._formSettingsTab.show(),$(this.element).find(".form-settings").addClass("DWF-active-tab")},i.prototype.openAddFieldTab=function(){this._hideTabs(),this._addFieldTab.show(),$(this.element).find(".add-field").addClass("DWF-active-tab")},i.prototype.disableSave=function(){this._formSettingsTab.disableSave()},i.prototype.enableSave=function(){this._formSettingsTab.enableSave()}}),define("dwf/views/add-field-tab",["require","exports","module","dwf/views/base-view","dwf/widgets","dwf/field-types","text!dwf/views/add-field-tab.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=a("dwf/widgets"),f=a("dwf/field-types").FIELD_TYPES,g=b.AddFieldTab=function(){};g.prototype=new d,g.prototype._template=a("text!dwf/views/add-field-tab.html"),g.prototype.activate=function(a,b){d.prototype.activate.call(this,a,b);var c=$("ul",this.element);for(var g=0,h=f.length;g<h;g++){var i=(new e[f[g].widget]).render("",{},[["one","Choice One"],["two","Choice Two"],["three","Choice Three"]]),j="<input type='hidden' value='"+f[g].fieldType+"--"+f[g].widget+"' />";c.append("<li>"+j+"<button>Add</button>"+"<p>"+f[g].description+"</p>"+i+"</li>")}},g.prototype.addListeners=function(a){$(this.element).delegate("button","click",function(){var b=$(this).closest("li").find("input[type=hidden]").val().split("--"),c=b[0],d=b[1];a.addField(c,d)})}}),define("dwf/views/base-view",["require","exports","module","dwf/util"],function(a,b,c){var d=b.View=function(){},e=a("dwf/util");d.prototype._template="<div></div>",d.prototype.activate=function(a,b){this.element=e.stringToDOM(this._template),this._elements=this.cacheElements(this._elements),a.appendChild(this.element),this.lib=b,this.addListeners(b)},d.prototype._elements={},d.prototype.cacheElements=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=$(this.element).find(a[c]));return b},d.prototype.clearCachedElements=function(){for(var a in this._elements)delete this._elements[a];delete this._elements},d.prototype.deactivate=function(){this.removeListeners(),this.clearCachedElements();while(this.element.firstChild)this.element.removeChild(this.element.firstChild);this.element.parentElement.removeChild(this.element)},d.prototype.addListeners=function(a){},d.prototype.removeListeners=function(){},d.prototype.show=function(){this.element.style.display="block"},d.prototype.hide=function(){this.element.style.display="none"}}),define("dwf/field-types",["require","exports","module"],function(a,b,c){b.FIELD_TYPES=[{fieldType:"BooleanField",widget:"CheckboxInput",description:"True or false checkbox"},{fieldType:"CharField",widget:"TextInput",description:"Short text"},{fieldType:"CharField",widget:"Textarea",description:"Large text"},{fieldType:"ChoiceField",widget:"Select",description:"Select single option",hasChoices:!0},{fieldType:"DateField",widget:"DateInput",description:"Date"},{fieldType:"DateTimeField",widget:"DateTimeInput",description:"Date and Time"},{fieldType:"EmailField",widget:"TextInput",description:"Email"},{fieldType:"FileField",widget:"FileInput",description:"File Upload"},{fieldType:"FloatField",widget:"TextInput",description:"Number (with or without decimal points)"},{fieldType:"ImageField",widget:"FileInput",description:"Image upload"},{fieldType:"IntegerField",widget:"TextInput",description:"Number (without decimal points)"},{fieldType:"IPAddressField",widget:"TextInput",description:"IP Address"},{fieldType:"MultipleChoiceField",widget:"CheckboxSelectMultiple",description:"Select multiple options",hasChoices:!0},{fieldType:"TimeField",widget:"TextInput",description:"Time"},{fieldType:"URLField",widget:"TextInput",description:"URL hyperlink"}],b.eachFieldType=function(a,c){var d=!0,e=0,f=b.FIELD_TYPES.length;c=c||{};for(;e<f&&d!==!1;e++)d=a.call(c,b.FIELD_TYPES[e])},b.hasChoices=function(a){var c=!1;b.eachFieldType(function(b){if(b.fieldType===a&&b.hasChoices){c=!0;return!1}});return c}}),define("text!dwf/views/add-field-tab.html",[],'<div id="DWF-add-field">\n  <ul>\n  </ul>\n</div>\n'),define("dwf/views/field-settings-tab",["require","exports","module","dwf/views/base-view","dwf/field-types","dwf/util","text!dwf/views/field-settings-tab.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=a("dwf/field-types"),f=a("dwf/util"),g=b.FieldSettingsTab=function(){};g.prototype=new d,g.prototype._template=a("text!dwf/views/field-settings-tab.html"),g.prototype.activate=function(a,b){d.prototype.activate.call(this,a,b),e.eachFieldType(function(a){this._elements.editFieldType.append('<option value="'+a.fieldType+"--"+a.widget+'">'+a.description+"</option>")},this)},g.prototype._elements={editFieldLabel:"#DWF-edit-field-label",editFieldHelpText:"#DWF-edit-field-help-text",editFieldRequired:"#DWF-edit-field-required",editField:"#DWF-edit-field",noFieldsMsg:"#DWF-no-fields-msg",noneSelectedMsg:"#DWF-none-selected-msg",editFieldType:"#DWF-edit-field-type",editFieldChoices:"#DWF-edit-field-choices"},g.prototype.addListeners=function(a){function c(b){a.updateActiveFieldHelpText($(this).val())}function b(b){a.updateActiveFieldLabel(this.value)}this._elements.editFieldLabel.keyup(b).change(b),this._elements.editFieldHelpText.keyup(c).change(c),this._elements.editFieldRequired.change(function(){a.updateActiveFieldRequired(this.checked)}),this._elements.editFieldType.change(f.bind(function(){var b=this._elements.editFieldType.find("option:selected").val().split("--"),c=b[0],d=b[1];a.updateActiveFieldType(c),a.updateActiveFieldWidget(d),this._maybeShowChoices(c)},this)),this._elements.editFieldChoices.on("click",".DWF-delete",function(b){a.deleteChoice($(b.target).parent().find("input").val()),$(b.target).parent().remove()}),this._elements.editFieldChoices.on("click","button",f.bind(function(){a.addChoice(function(a){this._addChoice(a)},this)},this)),this._elements.editFieldChoices.on("keyup change","input",f.bind(function(b){var c=[];this._elements.editFieldChoices.find("input").each(function(){c.push(this.value)}),a.updateActiveFieldChoices(c)},this)),this._elements.noFieldsMsg.find("a").click(a.openAddFieldTab)},g.prototype._maybeShowChoices=function(a){e.hasChoices(a)?(this._initializeChoices(),this._elements.editFieldChoices.show()):this._elements.editFieldChoices.hide()},g.prototype._addChoice=function(a){this._elements.editFieldChoices.find("ul").append('<li><span class="DWF-delete" title="Delete this choice">X</span><input type="text" value="'+a+'" /></li>')},g.prototype._initializeChoices=function(){this._elements.editFieldChoices.find("ul").contents().remove();var a=this.lib.getActiveFieldChoices();for(var b=0,c=a.length;b<c;b++)this._addChoice(a[b][1])},g.prototype.show=function(){this._elements.editField.hide(),this._elements.noFieldsMsg.hide(),this._elements.noneSelectedMsg.hide();if(this.lib.activeFieldExists()){this._elements.editFieldLabel.val(this.lib.getActiveFieldLabel()),this._elements.editFieldHelpText.val(this.lib.getActiveFieldHelpText()),this.lib.getActiveFieldRequired()?this._elements.editFieldRequired.attr("checked",!0):this._elements.editFieldRequired.removeAttr("checked");var a=this.lib.getActiveFieldType(),b=this.lib.getActiveFieldWidget(),c=a+"--"+b;this._elements.editFieldType.find("option").each(function(a,b){if(b.value===c){b.selected="selected";return!1}}),this._maybeShowChoices(a),$(this.element).find("#DWF-edit-field").show()}else this.lib.noFieldsExist()?this._elements.noFieldsMsg.show():this._elements.noneSelectedMsg.show();d.prototype.show.call(this)}}),define("text!dwf/views/field-settings-tab.html",[],'<div id="DWF-field-settings">\n\n  <p id="DWF-no-fields-msg">\n    There are no fields in this form! Try <a href="#">adding one</a>.\n  </p>\n\n  <p id="DWF-none-selected-msg">\n    To edit a field, first select one by clicking on it on the right.\n  </p>\n\n  <div id="DWF-edit-field">\n\n    <label>\n      Label\n      <input type="text" id="DWF-edit-field-label" />\n    </label>\n\n    <label>\n      Help text\n      <textarea id="DWF-edit-field-help-text">\n      </textarea>\n    </label>\n\n    <label>\n      Required\n      <input type="checkbox" id="DWF-edit-field-required" />\n    </label>\n\n    <label>\n      Field Type\n      <select id="DWF-edit-field-type">\n      </select>\n    </label>\n\n    <div id="DWF-edit-field-choices">\n      <label>Choices</label>\n      <ul>\n      </ul>\n      <button id="DWF-add-choice">Add new choice</button>\n    </div>\n\n  </div>\n\n</div>\n'),define("dwf/views/form-settings-tab",["require","exports","module","dwf/views/base-view","text!dwf/views/form-settings-tab.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=b.FormSettingsTab=function(){};e.prototype=new d,e.prototype._template=a("text!dwf/views/form-settings-tab.html"),e.prototype.addListeners=function(a){function c(b){a.updateFormDescription($(this).val())}function b(b){a.updateFormName(this.value)}$(this.element).find("#DWF-form-settings-name").keyup(b).change(b),$(this.element).find("#DWF-form-settings-description").keyup(c).change(c),$(this.element).find("button").click(function(){this.disabled||a.saveNow()})},e.prototype.show=function(){d.prototype.show.call(this),$(this.element).find("#DWF-form-settings-name").val(this.lib.getFormName()),$(this.element).find("#DWF-form-settings-description").val(this.lib.getFormDescription())},e.prototype.disableSave=function(){$(this.element).find("button").attr("disabled",!0).text("Saving...")},e.prototype.enableSave=function(){$(this.element).find("button").removeAttr("disabled").text("Save")}}),define("text!dwf/views/form-settings-tab.html",[],'<div id="DWF-form-settings">\n  <label>\n    Name\n    <input type="text" id="DWF-form-settings-name" />\n  </label>\n  <label>\n    Description\n    <textarea id="DWF-form-settings-description">\n    </textarea>\n  </label>\n  <a href="#">\n    <button>Save</button>\n  </a>\n</div>\n'),define("text!dwf/views/control-panel.html",[],'<div id="DWF-control-panel">\n\n  <ul id="DWF-control-panel-tabs">\n    <li class="add-field"><a href="#">Add a Field</a></li>\n    <li class="field-settings"><a href="#">Field Settings</a></li>\n    <li class="form-settings"><a href="#">Form Settings</a></li>\n  </ul>\n\n</div>\n'),define("dwf/views/form-preview",["require","exports","module","dwf/views/base-view","dwf/views/field-preview","dwf/widgets","dwf/util","jquery-ui","text!dwf/views/form-preview.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=a("dwf/views/field-preview").FieldPreview,f=a("dwf/widgets"),g=a("dwf/util");a("jquery-ui");var h=b.FormPreview=function(){};h.prototype=new d,h.prototype._template=a("text!dwf/views/form-preview.html"),h.prototype._elements={name:"#DWF-form-name",description:"#DWF-form-description",fields:"#DWF-form-fields"},h.prototype.activate=function(a,b){d.prototype.activate.call(this,a,b),this._elements.fields.sortable({placeholder:"DWF-field-placeholder",forcePlaceholderSize:!0}),this.activeField=null,this._fields=[]},h.prototype.addListeners=function(a){this._elements.fields.bind("sortupdate",g.bind(function(){this._elements.fields.find("li").each(function(b,c){a.updateFieldPosition($(c).find(".DWF-field-label").text(),b)})},this))},h.prototype.displayFormName=function(a){this._elements.name.text(a)},h.prototype.displayFormDescription=function(a){this._elements.description.text(a)},h.prototype.displayActiveFieldLabel=function(a){if(this.activeField)this.activeField.displayLabel(a);else throw new TypeError("No active field")},h.prototype.displayActiveFieldHelpText=function(a){if(this.activeField)this.activeField.displayHelpText(a);else throw new TypeError("No active field")},h.prototype.displayActiveFieldRequired=function(a){if(this.activeField)this.activeField.displayRequired(a);else throw new TypeError("No active field")},h.prototype.displayActiveFieldWidget=function(a,b){if(this.activeField)this.activeField.displayWidget(a,b);else throw new TypeError("No active field")},h.prototype.addField=function(a){var b=new e;this._fields.push(b),b.activate(this._elements.fields[0],$.extend({},this.lib,{activateField:g.bind(function(a){this.activeField=b;for(var c=0,d=this._fields.length;c<d;c++)this._fields[c]!==this.activeField&&this._fields[c].deactivateField();this.lib.activateField(a)},this)})),b.displayRequired(a.required()),b.displayLabel(a.label()),b.displayHelpText(a.helpText()),b.displayWidget(a.widget(),a.choices())}}),define("dwf/views/field-preview",["require","exports","module","dwf/views/base-view","dwf/widgets","dwf/util","text!dwf/views/field-preview.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=a("dwf/widgets"),f=a("dwf/util"),g=b.FieldPreview=function(){};g.prototype=new d,g.prototype._template=a("text!dwf/views/field-preview.html"),g.prototype._elements={required:".DWF-field-required",label:".DWF-field-label",helpText:".DWF-help-text",widget:".DWF-field-widget"},g.prototype.addListeners=function(a){$(this.element).click(f.bind(function(){a.activateField(this._elements.label.text()),this.activateField()},this)),$(this.element).find(".DWF-delete").click(f.bind(function(b){this.isActiveField()?a.deleteActiveField(this._elements.label.text()):a.deleteField(this._elements.label.text()),this.deactivate(),b.stopPropagation(),b.preventDefault()},this))},g.prototype.displayRequired=function(a){a?this._elements.required.show():this._elements.required.hide()},g.prototype.displayLabel=function(a){this._elements.label.text(a)},g.prototype.displayHelpText=function(a){this._elements.helpText.text(a)},g.prototype.displayWidget=function(a,b){this._elements.widget.contents().remove();var c={},d=e[a]?(new e[a]).render(null,c,b):(new e.TextInput).render(null,c);this._elements.widget.append(d)},g.prototype.activateField=function(){$(this.element).addClass("DWF-active-field")},g.prototype.isActiveField=function(){return $(this.element).hasClass("DWF-active-field")},g.prototype.deactivateField=function(){$(this.element).removeClass("DWF-active-field")}}),define("text!dwf/views/field-preview.html",[],'<li class="DWF-field" title="Drag and drop to change the order">\n  <a class="DWF-delete" title="Delete this field">X</a>\n  <span class="DWF-field-required">*</span>\n  <strong class="DWF-field-label"></strong>\n  <div class="DWF-help-text"></div>\n  <div class="DWF-field-widget"></div>\n</li>\n'),function(a,b){function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){c=b.parentNode,e=c.name;if(!b.href||!e||c.nodeName.toLowerCase()!=="map")return!1;b=a("img[usemap=#"+e+"]")[0];return!!b&&d(b)}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}a.ui=a.ui||{},a.ui.version||(a.extend(a.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;b=a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){c=a(this[0]);for(var d;c.length&&c[0]!==document;){d=c.css("position");if(d==="absolute"||d==="relative"||d==="fixed"){d=parseInt(c.css("zIndex"),10);if(!isNaN(d)&&d!==0)return d}c=c.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function e(b,c,d,e){a.each(f,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),e&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)});return c}var f=d==="Width"?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){b=a.ui[b].prototype;for(var e in d)b.plugins[e]=b.plugins[e]||[],b.plugins[e].push([c,d[e]])},call:function(a,b,c){if((b=a.plugins[b])&&a.element[0].parentNode)for(var d=0;d<b.length;d++)a.options[b[d][0]]&&b[d][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;c=c&&c==="left"?"scrollLeft":"scrollTop";var d=!1;if(b[c]>0)return!0;b[c]=1,d=b[c]>0,b[c]=0;return d},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))}(jQuery),function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}});return d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)},c=new c,c.options=a.extend(!0,{},c.options),a[e][b].prototype=a.extend(!0,c,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e;if(f&&e.charAt(0)==="_")return h;f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b){h=f;return!1}}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))});return h}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}this._setOptions(e);return this},_setOptions:function(b){var c=this;a.each(b,function(a,b){c._setOption(a,b)});return this},_setOption:function(a,b){this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",b);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e=this.options[b];c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),d=d||{};if(c.originalEvent){b=a.event.props.length;for(var f;b;)f=a.event.props[--b],c[f]=c.originalEvent[f]}this.element.trigger(c,d);return!(a.isFunction(e)&&e.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent")){a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation();return!1}}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var e=this,f=c.which==1,g=typeof this.options.cancel=="string"&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;if(!f||g||!this._mouseCapture(c))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)){this._mouseStarted=this._mouseStart(c)!==!1;if(!this._mouseStarted){c.preventDefault();return!0}}!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return e._mouseMove(a)},this._mouseUpDelegate=function(a){return e._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault();return b=!0}},_mouseMove:function(b){if(!a.browser.msie||document.documentMode>=9||!!b.button){if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1)?this._mouseDrag(b):this._mouseUp(b));return!this._mouseStarted}return this._mouseUp(b)},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b));return!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData("sortable-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this;a(b.target).parents().each(function(){if(a.data(this,"sortable-item")==f){e=a(this);return!1}}),a.data(b.target,"sortable-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var g=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(g=!0)});if(!g)return!1}this.currentItem=e,this._removeCurrentsFromItems();return!0},_mouseStart:function(b,c,e){c=this.options;var f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),c.containment&&this._setContainment(),c.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",c.cursor)),c.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",c.opacity)),c.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",c.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!e)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,f._uiHash(this));a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b);return!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,e=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),e!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(c=this.items.length-1;c>=0;c--){e=this.items[c];var f=e.item[0],g=this._intersectsWithPointer(e);if(g&&f!=this.currentItem[0]&&this.placeholder[g==1?"next":"prev"]()[0]!=f&&!a.ui.contains(this.placeholder[0],f)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],f):!0)){this.direction=g==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(e))this._rearrange(b,e);else break;this._trigger("change",b,this._uiHash());break}}this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(b,c){if(b){a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var e=this;c=e.placeholder.offset(),e.reverting=!0,a(this.helper).animate({left:c.left-this.offset.parent.left-e.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:c.top-this.offset.parent.top-e.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){e._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem));return this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),e=[];b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&e.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!e.length&&b.key&&e.push(b.key+"=");return e.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),e=[];b=b||{},c.each(function(){e.push(a(b.item||this).attr(b.attribute||"id")||"")});return e},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left;j=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?j:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height);b=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),c=c&&b,b=this._getDragVerticalDirection();var e=this._getDragHorizontalDirection();return c?this.floating?e&&e=="right"||b=="down"?2:1:b&&(b=="down"?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height);b=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width);var e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&b||f=="left"&&!b:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){this._refreshItems(a),this.refreshPositions();return this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=[],e=[],f=this._connectWith();if(f&&b)for(b=f.length-1;b>=0;b--)for(var g=a(f[b]),h=g.length-1;h>=0;h--){var i=a.data(g[h],"sortable");i&&i!=this&&!i.options.disabled&&e.push([a.isFunction(i.options.items)?i.options.items.call(i.element):a(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i])}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(b=e.length-1;b>=0;b--)e[b][0].each(function(){c.push(this)});return a(c)},_removeCurrentsFromItems:function(){for(var a=this.currentItem.find(":data(sortable-item)"),b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f)for(var g=f.length-1;g>=0;g--)for(var h=a(f[g]),i=h.length-1;i>=0;i--){var j=a.data(h[i],"sortable");j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}for(g=e.length-1;g>=0;g--){b=e[g][1],f=e[g][0],i=0;for(h=f.length;i<h;i++)j=a(f[i]),j.data("sortable-item",b),c.push({item:j,instance:b,width:0,height:0,left:0,top:0})}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var e=this.items[c];if(e.instance==this.currentContainer||!this.currentContainer||e.item[0]==this.currentItem[0]){var f=this.options.toleranceElement?a(this.options.toleranceElement,e.item):e.item;b||(e.width=f.outerWidth(),e.height=f.outerHeight()),f=f.offset(),e.left=f.left,e.top=f.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){var c=b||this,e=c.options;if(!e.placeholder||e.placeholder.constructor==String){var f=e.placeholder;e.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(f||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];f||(b.style.visibility="hidden");return b},update:function(a,b){if(!f||!!e.forcePlaceholderSize)b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(e.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),e.placeholder.update(c,c.placeholder)},_contactContainers:function(b){for(var c=null,e=null,f=this.containers.length-1;f>=0;f--)if(!a.ui.contains(this.currentItem[0],this.containers[f].element[0]))if(this._intersectsWith(this.containers[f].containerCache)){if(!c||!a.ui.contains(this.containers[f].element[0],c.element[0]))c=this.containers[f],e=f}else this.containers[f].containerCache.over&&(this.containers[f]._trigger("out",b,this._uiHash(this)),this.containers[f].containerCache.over=0);if(c)if(this.containers.length===1)this.containers[e]._trigger("over",b,this._uiHash(this)),this.containers[e].containerCache.over=1;else if(this.currentContainer!=this.containers[e]){c=1e4,f=null;for(var g=this.positionAbs[this.containers[e].floating?"left":"top"],h=this.items.length-1;h>=0;h--)if(a.ui.contains(this.containers[e].element[0],this.items[h].item[0])){var i=this.items[h][this.containers[e].floating?"left":"top"];Math.abs(i-g)<c&&(c=Math.abs(i-g),f=this.items[h])}if(f||this.options.dropOnEmpty)this.currentContainer=this.containers[e],f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[e].element,!0),this._trigger("change",b,this._uiHash()),this.containers[e]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[e]._trigger("over",b,this._uiHash(this)),this.containers[e].containerCache.over=1}},_createHelper:function(b){var c=this.options;b=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem,b.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(b[0]),b[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(b[0].style.width==""||c.forceHelperSize)&&b.width(this.currentItem.width()),(b[0].style.height==""||c.forceHelperSize)&&b.height(this.currentItem.height());return b},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0];b=a(b.containment).offset();var e=a(c).css("overflow")!="hidden";this.containment=[b.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,b.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,b.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position),b=b=="absolute"?1:-1;var e=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*b+this.offset.parent.top*b-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:e.scrollTop())*b),left:c.left+this.offset.relative.left*b+this.offset.parent.left*b-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*b)}},_generatePosition:function(b){var c=this.options,e=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=/(html|body)/i.test(e[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var g=b.pageX,h=b.pageY;this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(g=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(h=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(g=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(h=this.containment[3]+this.offset.click.top)),c.grid&&(h=this.originalPageY+Math.round((h-this.originalPageY)/c.grid[1])*c.grid[1],h=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h,g=this.originalPageX+Math.round((g-this.originalPageX)/c.grid[0])*c.grid[0],g=this.containment?g-this.offset.click.left<this.containment[0]||g-this.offset.click.left>this.containment[2]?g-this.offset.click.left<this.containment[0]?g+c.grid[0]:g-c.grid[0]:g:g));return{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():f?0:e.scrollTop()),left:g-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var e=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&e.push(function(a){this._trigger("update",a,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||e.push(function(a){this._trigger("remove",a,this._uiHash())});for(f=this.containers.length-1;f>=0;f--)a.ui.contains(this.containers[f].element[0],this.currentItem[0])&&!c&&(e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.containers[f])),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.containers[f])))}for(f=this.containers.length-1;f>=0;f--)c||e.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(e.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(f=0;f<e.length;f++)e[f].call(this,b);this._trigger("stop",b,this._uiHash())}return!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(f=0;f<e.length;f++)e[f].call(this,b);this._trigger("stop",b,this._uiHash())}this.fromOutside=!1;return!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.16"})}(jQuery),define("text!dwf/views/form-preview.html",[],'<div id="DWF-form">\n  <h1 id="DWF-form-name"></h1>\n  <div id="DWF-form-description"></div>\n  <ol id="DWF-form-fields"></ol>\n</div>\n'),define("dwf/views/messages",["require","exports","module","dwf/views/base-view","dwf/util","text!dwf/views/messages.html"],function(a,b,c){var d=a("dwf/views/base-view").View,e=a("dwf/util"),f=b.Messages=function(){};f.prototype=new d,f.prototype._template=a("text!dwf/views/messages.html"),f.prototype._messageCounter=0,f.prototype.DEFAULT_MESSAGE_TIME=2e4,f.prototype.MESSAGE_FADE_TIME=1e3,f.prototype._attachMessage=function(a,b,c,d){a=$('<li class="'+b+'" id="DWF-message-'+c+'">'+a+"</li>"),a.click(e.bind(function(){this.removeMessage(c)},this)),a.hide(),a.appendTo(this.element),a.fadeIn(this.MESSAGE_FADE_TIME),setTimeout(e.bind(function(){this.removeMessage(c)},this),d||this.DEFAULT_MESSAGE_TIME)},f.prototype.success=function(a,b){var c=this._messageCounter++;this._attachMessage(a,"DWF-message-success",c,b);return c},f.prototype.info=function(a,b){var c=this._messageCounter++;this._attachMessage(a,"DWF-message-info",c,b);return c},f.prototype.warn=function(a,b){var c=this._messageCounter++;this._attachMessage(a,"DWF-message-warn",c,b);return c},f.prototype.removeMessage=function(a){$(this.element).find("#DWF-message-"+a).fadeOut(this.MESSAGE_FADE_TIME)}}),define("text!dwf/views/messages.html",[],'<ul id="DWF-messages">\n</ul>\n'),define("dwf/models/form",["require","exports","module","dwf/transactions","dwf/util","dwf/models/field"],function(a,b,c){var d=a("dwf/transactions"),e=a("dwf/util"),f=a("dwf/models/field").Field,g=b.Form=function(a){this._id=a.id,this._name=a.name,this._description=a.description,this._fields=[];for(var b=0,c=a.fields.length;b<c;b++)this._fields.push(new f(a.fields[b]));this.activeField=null};g.prototype._sortFields=function(){this._fields.sort(function(a,b){return a.position()-b.position()})},g.prototype.id=function(){return this._id},g.prototype.description=e.getSetter("_description",function(a){d.addTransaction({action:"change description",to:a})}),g.prototype.name=e.getSetter("_name",function(a){d.addTransaction({action:"change name",to:a})}),g.prototype.hasFields=function(){return this._fields.length>0},g.prototype.addField=function(a,b,c){var e=new f({label:a,type:b,widget:c,help_text:"",required:!0,choices:[],position:this._fields.length});this._fields.push(e),d.addTransaction({action:"add field",label:a}),d.addTransaction({action:"change field type",label:a,to:b}),d.addTransaction({action:"change field widget",label:a,to:c});return e},g.prototype.deleteField=function(a){var b,c;this.eachField(function(d,e){if(d.label()===a){b=d,c=e;return!1}});if(!b)throw Error("Can't delete a field that doesn't exist");this._fields.splice(c,1),d.addTransaction({action:"remove field",label:b.label()}),b===this.activeField&&delete this.activeField,this._sortFields();for(var e=0,f=this._fields.length;e<f;e++)this._fields[e].position(e)},g.prototype.getFieldByLabel=function(a){for(var b=0,c=this._fields.length;b<c;b++)if(a===this._fields[b].label())return this._fields[b];return null},g.prototype.eachField=function(a,b){var c=0,d=this._fields.length,e=!0;b=b||{},this._sortFields();for(;c<d&&e!==!1;c++)e=a.call(b,this._fields[c],c)}}),define("dwf/models/field",["require","exports","module","dwf/transactions","dwf/util","dwf/models/choice","dwf/field-types"],function(a,b,c){var d=a("dwf/transactions"),e=a("dwf/util"),f=a("dwf/models/choice").Choice,g=a("dwf/field-types"),h=b.Field=function(a){this._label=a.label,this._type=a.type,this._widget=a.widget,this._helpText=a.help_text,this._required=a.required,this._position=a.position,this._choices=[];for(var b=0,c=a.choices.length;b<c;b++)this._choices.push(new f(a.choices[b],this))};h.prototype.label=e.getSetter("_label",function(a,b){d.addTransaction({action:"rename field",label:b,to:a})}),h.prototype.helpText=e.getSetter("_helpText",function(a){d.addTransaction({action:"change help text",label:this.label(),to:a})}),h.prototype.required=e.getSetter("_required",function(a){d.addTransaction({action:"change field required",label:this.label(),to:Boolean(a)})}),h.prototype.type=e.getSetter("_type",function(a){d.addTransaction({action:"change field type",label:this.label(),to:a}),g.hasChoices()||(this._choices=[])}),h.prototype.widget=e.getSetter("_widget",function(a){d.addTransaction({action:"change field widget",label:this.label(),to:a})}),h.prototype.position=e.getSetter("_position",function(a){d.addTransaction({action:"move field",label:this.label(),to:Math.floor(Number(a))})}),h.prototype._sortChoices=function(){this._choices.sort(function(a,b){return a.position()-b.position()})},h.prototype.choices=function(){var a=[];this.eachChoice(function(b){a.push([b.label().replace(" ","_").replace(/\W/g,""),b.label()])});return a},h.prototype.addChoice=function(a){var b=new f({label:a,position:this._choices.length},this);this._choices.push(b),d.addTransaction({action:"add choice",label:this.label(),choice_label:a})},h.prototype.getChoiceByLabel=function(a){var b=null;this.eachChoice(function(c){if(c.label()===a){b=c;return!1}});return b},h.prototype.deleteChoice=function(a){var b,c;this.eachChoice(function(d,e){if(d.label()===a){b=d,c=e;return!1}});if(!b)throw Error("Can't delete a choice that doesn't exist");this._choices.splice(c,1),d.addTransaction({action:"remove choice",label:this.label(),choice_label:a}),this._sortChoices();for(var e=0,f=this._choices.length;e<f;e++)this._choices[e].position(e)},h.prototype.eachChoice=function(a,b){var c=0,d=this._choices.length,e=!0;b=b||{},this._sortChoices();for(;c<d&&e!==!1;c++)e=a.call(b,this._choices[c],c)}}),define("dwf/models/choice",["require","exports","module","dwf/transactions","dwf/util"],function(a,b,c){var d=a("dwf/transactions"),e=a("dwf/util"),f=b.Choice=function(a,b){this._label=a.label,this._position=a.position,this._field=b};f.prototype.label=e.getSetter("_label",function(a,b){d.addTransaction({action:"change choice",label:this._field.label(),choice_label:b,to:a})}),f.prototype.position=e.getSetter("_position",function(a,b){a!==b&&d.addTransaction({action:"move choice",label:this._field.label(),choice_label:this.label(),to:Number(a)})})})